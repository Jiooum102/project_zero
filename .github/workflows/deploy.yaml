name: CD Pipeline

on:
  push: { }
  workflow_dispatch: { }

jobs:
  deploy:
    runs-on: self-hosted
    steps:
      - name: deploy all services
        run: docker compose -f system_monitoring/docker-compose.yml up -d
      - name: deploy prometheus
        run: docker compose -f system_monitoring/docker-compose.yml restart prometheus
      - name: stop grafana
        run: docker compose -f system_monitoring/docker-compose.yml down grafana
      - name: deploy grafana
        run: docker compose -f system_monitoring/docker-compose.yml up grafana -d
